<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<!-- Bootstrap Core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom CSS -->
		<link href="css/homepage.css" rel="stylesheet">
		<script src="js/jquery.js" type="text/javascript"></script>
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<img id="cursor" src="cursor.webp" style="position: absolute; display:none; z-index: 99;">
		<div class="atm">
			<div class="header">
				<center>
					<img style="height:50px" src="logo.png">
				</center>
			</div>
			<div class="row">
				<div class="col-md-1">&nbsp;</div>
				<div class="col-md-10" id="display">
					
				</div>
				<div class="col-md-1">&nbsp;</div>
			</div>
		</div>
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			var documentWidth = document.documentElement.clientWidth;
			var documentHeight = document.documentElement.clientHeight;
			
			var cursor = document.getElementById("cursor");
			var cursorX = documentWidth / 2;
			var cursorY = documentHeight / 2;
			
			page("main");

			function page(id) {
				if (id == "main") {
					$("#display").html('<div class="row" style="height:50px"></div><div class="row" style="height:100px"><div class="col-lg-6"><button class="btn btn-success btn-block" onclick="pageDeposit()">Deposit</button></div><div class="col-lg-6"><button class="btn btn-success btn-block" onclick="pageWithdraw()">Withdraw</button></div></div><div class="row" style="height:25px"></div><div class="row" style="height:100px"><div class="col-lg-6"><button class="btn btn-success btn-block" id="transfer" onclick="transfer()">Transfer</button></div><div class="col-lg-6"><button class="btn btn-success btn-block" onclick="btnExit()">Exit</button></div></div><div class="row" style="height:50px"></div>');
				} else if (id == "deposit") {
					$("#display").html('<div class="row" style="height:25px"></div><div class="row" style="height:100px"><div class="form-group" style="width:100%"><label for="amount">Amount</label><input type="number" class="form-control" id="amount" placeholder="Amount"></div></div><div class="row" style="height:25"><button class="btn btn-success btn-block" onclick="deposit()">Deposit</button></div><br/><div class="row" style="height:25"><button class="btn btn-danger btn-block" onClick="pageMain()">Cancel</button></div>');
				} else if (id == "withdraw") {
					$("#display").html('<div class="row" style="height:25px"></div><div class="row" style="height:100px"><div class="form-group" style="width:100%"><label for="amount">Amount</label><input type="number" class="form-control" id="amount" placeholder="Amount"></div></div><div class="row" style="height:25"><button class="btn btn-success btn-block" onclick="withdraw()">Withdraw</button></div><br/><div class="row" style="height:25"><button class="btn btn-danger btn-block" onClick="pageMain()">Cancel</button></div>');
				}
			}

			function UpdateCursorPos() {
			    $(cursor).css('left', cursorX)
			    $(cursor).css('top', cursorY)
			}
			
			function Click(x, y) {
			    var element = $(document.elementFromPoint(x, y));
			    element.focus().click();
			}

			$("#deposit").click(pageDeposit);
			$("#withdraw").click(pageWithdraw);
			$("#exit").click(btnExit);

			function pageMain() {
				page("main");
			}

			function pageDeposit() {
				page("deposit");
			}

			function pageWithdraw() {
				page("withdraw");
			}

			function transfer() {
				$.post('http://sa_banking/transfer', JSON.stringify({}));
			}
			
			function btnExit() {
				$.post('http://sa_banking/escape', JSON.stringify({}));
			}

			function deposit() {
				$.post('http://sa_banking/deposit', JSON.stringify({amount:$("#amount").val()}));
				pageMain();
			}

			function withdraw() {
				$.post('http://sa_banking/withdraw', JSON.stringify({amount:$("#amount").val()}));
				pageMain();
			}

			$(function() {
				$(cursor).css('display', "none");
				$("body").css('display', "none");
				$("body").css('background', 'none');
			    window.addEventListener('message', function(event) {
			        if (event.data.type == "enableatm") {
			            $(cursor).css('display', event.data.enable ? "block" : "none");
			            $("body").css('display', event.data.enable ? "block" : "none");
			            $("body").css('background', event.data.enable ? "white" : "none");
			        } else if (event.data.type == "click") {
			            // Avoid clicking the cursor itself, click 1px to the top/left;
			            Click(cursorX - 1, cursorY - 1);
			        }
			    });
			
			    $(document).mousemove(function(event) {
			        cursorX = event.pageX;
			        cursorY = event.pageY;
			        UpdateCursorPos();
			    });
			
			    document.onkeyup = function (data) {
			        if (data.which == 27) { // Escape key
			            $.post('http://sa_banking/escape', JSON.stringify({}));
			            page("main");
			        }
			    };
			});
			function checkAlpha(text) {
				var letters = /^[A-Za-z]+$/;
				if (text.match(letters)) {
					return true;
				} else {
					return false;
				}
			}
		</script>
	</body>
</html>
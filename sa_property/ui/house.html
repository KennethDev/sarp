<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<!-- Bootstrap Core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom CSS -->
		<link href="css/homepage.css" rel="stylesheet">
		<script src="js/jquery.js" type="text/javascript"></script>
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
		<style>
			.hidden {
				display: none;
			}
		</style>
	</head>
	<body>
		<img id="cursor" src="cursor.webp" style="position: absolute; display:none; z-index: 99;">
		<div class="atm">
			<div class="header">
				<center>
					<img style="height:50px" src="logo.png">
				</center>
			</div>
			<br/>
			<div class="row">
				<div class="col-md-9">
					<div class="container" id="display">

					</div>
				</div>
				<div class="col-md-3">
					<div class="container" id="buttons">
						<button class="btn btn-block btn-primary hidden" id="carbutton" onclick="opengarage()">Garage</button>
						<button class="btn btn-block btn-primary hidden" id="interior" onclick="interior()">Go Inside</button>
						<button class="btn btn-block btn-success" id="dabutton" onclick="buy()">Buy</button>
					</div>
				</div>
			</div>
		</div>
		<div id="hometemplate" style="display:none;">
			<h4>Viewing Property: <span id="address"></span></h4>
			<h5 style="margin-top: -5px;">$<span id="price"></span></h5>
		</div>
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			var documentWidth = document.documentElement.clientWidth;
			var documentHeight = document.documentElement.clientHeight;
			
			var cursor = document.getElementById("cursor");
			var cursorX = documentWidth / 2;
			var cursorY = documentHeight / 2;

			var property = null;
			
			page("main");

			function page(id) {
				if (id == "main") {
					$("#display").html($("#hometemplate").html());
				}
			}

			function UpdateCursorPos() {
			    $(cursor).css('left', cursorX)
			    $(cursor).css('top', cursorY)
			}
			
			function Click(x, y) {
			    var element = $(document.elementFromPoint(x, y));
			    element.focus().click();
			}

			function pageMain() {
				page("main");
			}

			function buy() {
				$.post('http://sa_property/buy', JSON.stringify({id: property.id}));
			}

			function sell() {
				$.post('http://sa_property/sell', JSON.stringify({id: property.id}));
			}
			
			function opengarage() {
				$.post('http://sa_property/garage', JSON.stringify({id: property.id}));
			}

			function interior() {
				$.post('http://sa_property/interior', JSON.stringify({extra: property.extra}))
			}

			function btnExit() {
				$.post('http://sa_property/escape', JSON.stringify({}));
			}

			$(function() {
				$(cursor).css('display', "none");
				$("body").css('display', "none");
				$("body").css('background', 'none');
			    window.addEventListener('message', function(event) {
			        if (event.data.type == "enablehouse") {
			            $(cursor).css('display', event.data.enable ? "block" : "none");
			            $("body").css('display', event.data.enable ? "block" : "none");
			            $("body").css('background', event.data.enable ? "white" : "none");
			            if (event.data.enable) {
			            	property = event.data.property;
			            	page("main");
			            	$("#address").html(property.address)
			            	var addprice = "";
			            	if (event.data.owned) {
			            		addprice = "<span style=\"color:green\"> [OWNED]</span>";
			            		$("#dabutton").html("Sell");
			            		$("#dabutton").attr("onclick", "sell()");
			            		$("#dabutton").removeClass("btn-success");
			            		$("#dabutton").addClass("btn-danger");
			            		$("#carbutton").removeClass("hidden");
			            		if (property.extra != "none") {
			            			$("#interior").removeClass("hidden");
			            		}
			            	} else {
			            		$("#dabutton").html("Buy");
			            		$("#dabutton").attr("onclick", "buy()");
			            		$("#dabutton").addClass("btn-success");
			            		$("#dabutton").removeClass("btn-danger");
			            		$("#carbutton").addClass("hidden");
			            		$("#interior").addClass("hidden");
			            	}
			            	$("#price").html((property.price).formatMoney(0, '.', ',') + addprice);
			            }
			        } else if (event.data.type == "click") {
			            // Avoid clicking the cursor itself, click 1px to the top/left;
			            Click(cursorX - 1, cursorY - 1);
			        }
			    });
			
			    $(document).mousemove(function(event) {
			        cursorX = event.pageX;
			        cursorY = event.pageY;
			        UpdateCursorPos();
			    });
			
			    document.onkeyup = function (data) {
			        if (data.which == 27) { // Escape key
			            $.post('http://sa_property/escape', JSON.stringify({}));
			            page("main");
			        }
			    };
			});
			function checkAlpha(text) {
				var letters = /^[A-Za-z]+$/;
				if (text.match(letters)) {
					return true;
				} else {
					return false;
				}
			}
			Number.prototype.formatMoney = function(c, d, t){
			var n = this, 
			    c = isNaN(c = Math.abs(c)) ? 2 : c, 
			    d = d == undefined ? "." : d, 
			    t = t == undefined ? "," : t, 
			    s = n < 0 ? "-" : "", 
			    i = String(parseInt(n = Math.abs(Number(n) || 0).toFixed(c))), 
			    j = (j = i.length) > 3 ? j % 3 : 0;
			   return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
			 };
		</script>
	</body>
</html>